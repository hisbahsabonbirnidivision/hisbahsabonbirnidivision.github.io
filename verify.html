<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Verify Member ‚Äî HISBAH SABON BIRNI DIVISION</title>
<meta name="description" content="Verify HISBAH members by Identification No." />
<style>
  :root{--green:#0b6623;--bg:#f4f7f6;--card:#fff;--muted:#666}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#111}
  .wrap{max-width:920px;margin:28px auto;padding:18px}
  header{background:var(--green);color:#fff;padding:18px;border-radius:10px;text-align:center}
  header h1{margin:0;font-size:20px}
  .card{background:var(--card);padding:18px;border-radius:10px;margin-top:18px;box-shadow:0 10px 24px rgba(10,20,10,0.05)}
  label{display:block;margin-bottom:6px;color:#0b3d18;font-weight:600}
  input[type=text]{width:100%;padding:12px;border-radius:8px;border:1px solid #e6eee6;outline:none;font-size:15px}
  .btn{display:inline-block;margin-top:10px;background:var(--green);color:#fff;padding:10px 16px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .result{margin-top:18px}
  .idcard{display:flex;gap:18px;align-items:center;padding:14px;border-radius:8px;border:1px solid #e9f0ea;background:linear-gradient(180deg,#fff,#fbfffb)}
  .photo{width:140px;height:140px;border-radius:6px;object-fit:cover;border:1px solid #ddd}
  .meta h3{margin:0 0 6px 0}
  .muted{color:var(--muted)}
  .badge{display:inline-block;background:#e6f7ea;color:var(--green);padding:6px 10px;border-radius:16px;font-weight:700}
  .notfound{padding:18px;border-radius:8px;background:#fff5f5;border:1px solid #ffdede;color:#8b1a1a}
  @media(max-width:720px){ .idcard{flex-direction:column;align-items:center;text-align:center} .photo{width:120px;height:120px}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>HISBAH SABON BIRNI DIVISION ‚Äî Member Verification</h1>
    </header>

    <div class="card">
      <label for="q">Enter Identification No (example: HSBD/0001)</label>
      <input id="q" type="text" placeholder="Enter Identification No" autocomplete="off" />
      <div>
        <button id="searchBtn" class="btn">üîç Verify</button>
        <button id="clearBtn" class="btn" style="background:#777;margin-left:8px">Clear</button>
      </div>

      <div id="output" class="result" aria-live="polite"></div>
      <p class="muted" style="margin-top:12px">Data source: <strong>HISBAH MEMBERS VERIFICATION.csv</strong> (must be uploaded to the repo root).</p>
    </div>
  </div>

<script>
/*
  verify.html
  - Expects CSV file in repo root named exactly: "HISBAH MEMBERS VERIFICATION.csv"
  - CSV headers must match exactly: Full Name, Identification No, Team, Photo
  - Search is case-insensitive and matches Identification No field
*/

const csvFileName = 'HISBAH MEMBERS VERIFICATION.csv'; // exact name
const idField = 'Identification No'; // exact header name in CSV
const nameField = 'Full Name';
const teamField = 'Team';
const photoField = 'Photo';

let members = [];

// load CSV when page opens
window.addEventListener('load', () => {
  loadCSV();
  document.getElementById('searchBtn').addEventListener('click', onSearch);
  document.getElementById('clearBtn').addEventListener('click', () => {
    document.getElementById('q').value = '';
    document.getElementById('output').innerHTML = '';
  });
  document.getElementById('q').addEventListener('keypress', (e) => { if(e.key==='Enter') onSearch(); });
});

async function loadCSV(){
  const url = encodeURI(csvFileName + '?t=' + Date.now()); // encode spaces
  try{
    const res = await fetch(url);
    if(!res.ok) throw new Error('CSV not found (check filename & location).');
    const txt = await res.text();
    members = parseCSV(txt);
  }catch(err){
    document.getElementById('output').innerHTML = '<div class="notfound">Error loading data: '+escapeHtml(err.message) + ' <br/>Make sure the CSV file is uploaded in repo root and the filename matches exactly.</div>';
    console.error(err);
  }
}

function parseCSV(text){
  const lines = text.replace(/\r/g,'').split('\n').filter(l => l.trim() !== '');
  if(lines.length === 0) return [];
  const headers = lines[0].split(',').map(h => h.trim());
  const rows = lines.slice(1).map(line => {
    // split but keep commas inside quotes
    const values = splitCSVLine(line);
    const obj = {};
    headers.forEach((h, i) => obj[h] = (values[i] || '').trim());
    return obj;
  });
  return rows;
}

function splitCSVLine(line) {
  const out = [];
  let cur = '', inQuotes = false;
  for (let i=0;i<line.length;i++){
    const ch = line[i];
    if (ch === '"' ) { inQuotes = !inQuotes; continue; }
    if (ch === ',' && !inQuotes) { out.push(cur); cur=''; continue; }
    cur += ch;
  }
  out.push(cur);
  return out;
}

function escapeHtml(s){ return String(s||'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

function onSearch(){
  const q = document.getElementById('q').value.trim();
  if(!q){ alert('Enter Identification No'); return; }
  if(members.length === 0){ alert('Member data not loaded yet or CSV missing.'); return; }

  const found = members.find(m => ((m[idField]||'').toLowerCase() === q.toLowerCase()));
  const out = document.getElementById('output');
  if(!found){
    out.innerHTML = '<div class="notfound">No record found for ID: <strong>' + escapeHtml(q) + '</strong></div>';
    return;
  }

  const photoUrlRaw = found[photoField] || '';
  const photoUrl = (photoUrlRaw && photoUrlRaw !== '-' && photoUrlRaw.toLowerCase() !== 'null') ? photoUrlRaw : 'https://via.placeholder.com/140?text=No+Photo';
  out.innerHTML = `
    <div class="idcard">
      <img src="${escapeHtml(photoUrl)}" alt="photo" class="photo" onerror="this.src='https://via.placeholder.com/140?text=No+Photo'">
      <div class="meta">
        <h3>${escapeHtml(found[nameField]||'')}</h3>
        <p style="margin:6px 0"><strong>Identification No:</strong> ${escapeHtml(found[idField]||'')}</p>
        <p style="margin:6px 0"><strong>Team:</strong> ${escapeHtml(found[teamField]||'')}</p>
        <p style="margin:6px 0"><strong>Status:</strong> <span class="badge">‚úÖ Verified Member</span></p>
      </div>
    </div>
  `;
}
</script>
</body>
</html>
